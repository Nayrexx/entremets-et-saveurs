<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÑ Admin - Entremets & Saveurs</title>
    <link rel="icon" type="image/svg+xml" href="assets/images/favicon.svg">
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary: #c41e3a;
            --primary-dark: #a01830;
            --secondary: #165b33;
            --gold: #d4af37;
            --bg: #f5f5f5;
            --white: #fff;
            --text: #333;
            --text-light: #666;
            --shadow: 0 2px 15px rgba(0,0,0,0.1);
            --radius: 12px;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Poppins', sans-serif; background: var(--bg); min-height: 100vh; }

        /* LOGIN */
        .login-page {
            min-height: 100vh; display: flex; align-items: center; justify-content: center;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
        }
        .login-box {
            background: var(--white); padding: 2.5rem; border-radius: var(--radius);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3); width: 100%; max-width: 380px; text-align: center;
        }
        .login-box h1 { font-family: 'Playfair Display', serif; color: var(--primary); margin-bottom: 0.3rem; font-size: 1.8rem; }
        .login-box p { color: var(--text-light); margin-bottom: 1.5rem; font-size: 0.9rem; }
        .input-group { margin-bottom: 1rem; text-align: left; }
        .input-group label { display: block; margin-bottom: 0.4rem; font-weight: 500; font-size: 0.9rem; }
        .input-group input {
            width: 100%; padding: 0.75rem 1rem; border: 2px solid #e0e0e0;
            border-radius: 8px; font-size: 1rem; transition: 0.3s;
        }
        .input-group input:focus { outline: none; border-color: var(--primary); }
        .btn {
            padding: 0.75rem 1.5rem; border: none; border-radius: 8px;
            font-weight: 600; cursor: pointer; transition: 0.3s; font-size: 0.95rem;
        }
        .btn-primary { background: var(--primary); color: var(--white); width: 100%; }
        .btn-primary:hover { background: var(--primary-dark); }
        .btn-save { background: var(--secondary); color: var(--white); }
        .btn-save:hover { background: #0d4020; }
        .btn-danger { background: #dc3545; color: var(--white); }
        .error-msg { background: #ffe0e0; color: #c00; padding: 0.7rem; border-radius: 8px; margin-bottom: 1rem; display: none; font-size: 0.9rem; }

        /* ADMIN */
        .admin-page { display: none; }
        .admin-header {
            background: var(--white); padding: 1rem 2rem; box-shadow: var(--shadow);
            display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 100;
        }
        .admin-header h1 { font-family: 'Playfair Display', serif; color: var(--primary); font-size: 1.4rem; }
        .admin-nav { display: flex; gap: 0.3rem; flex-wrap: wrap; }
        .admin-nav a {
            padding: 0.5rem 1rem; border-radius: 8px; text-decoration: none;
            color: var(--text); font-size: 0.9rem; transition: 0.3s;
        }
        .admin-nav a:hover, .admin-nav a.active { background: var(--primary); color: var(--white); }
        .btn-logout { background: var(--text-light); color: var(--white); padding: 0.5rem 1rem; border-radius: 8px; border: none; cursor: pointer; }
        .btn-logout:hover { background: var(--primary); }

        .admin-content { padding: 1.5rem; max-width: 1100px; margin: 0 auto; }
        .section { background: var(--white); border-radius: var(--radius); padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow); }
        .section h2 { font-family: 'Playfair Display', serif; margin-bottom: 1rem; padding-bottom: 0.8rem; border-bottom: 2px solid var(--bg); display: flex; align-items: center; gap: 0.5rem; font-size: 1.2rem; }
        .section h2 i { color: var(--primary); }

        /* TOGGLE */
        .toggle-row { display: flex; align-items: center; justify-content: space-between; padding: 0.8rem 0; border-bottom: 1px solid #eee; }
        .toggle-row:last-child { border-bottom: none; }
        .toggle-info h4 { font-size: 0.95rem; margin-bottom: 0.2rem; }
        .toggle-info p { font-size: 0.8rem; color: var(--text-light); }
        .toggle { position: relative; width: 50px; height: 26px; }
        .toggle input { opacity: 0; width: 0; height: 0; }
        .toggle span {
            position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0;
            background: #ccc; border-radius: 26px; transition: 0.3s;
        }
        .toggle span:before {
            content: ""; position: absolute; width: 20px; height: 20px;
            left: 3px; bottom: 3px; background: var(--white); border-radius: 50%; transition: 0.3s;
        }
        .toggle input:checked + span { background: var(--secondary); }
        .toggle input:checked + span:before { transform: translateX(24px); }

        /* FORM */
        .form-group { margin-bottom: 1rem; }
        .form-group label { display: block; margin-bottom: 0.4rem; font-weight: 500; font-size: 0.9rem; }
        .form-group input, .form-group textarea, .form-group select {
            width: 100%; padding: 0.7rem; border: 2px solid #e0e0e0;
            border-radius: 8px; font-size: 0.95rem; font-family: inherit; transition: 0.3s;
        }
        .form-group input:focus, .form-group textarea:focus { outline: none; border-color: var(--primary); }
        .form-group textarea { min-height: 80px; resize: vertical; }
        .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 1rem; }
        @media(max-width:600px) { .form-row { grid-template-columns: 1fr; } }

        /* TABS */
        .tabs { display: flex; gap: 0.5rem; margin-bottom: 1rem; flex-wrap: wrap; }
        .tab-btn { padding: 0.5rem 1rem; border: none; background: var(--bg); cursor: pointer; border-radius: 8px; font-size: 0.9rem; }
        .tab-btn.active { background: var(--primary); color: var(--white); }
        .tab-panel { display: none; }
        .tab-panel.active { display: block; }

        /* GALLERY */
        .gallery-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .gallery-item { position: relative; border-radius: 8px; overflow: hidden; aspect-ratio: 1; }
        .gallery-item img { width: 100%; height: 100%; object-fit: cover; }
        .gallery-item .delete-btn {
            position: absolute; top: 5px; right: 5px; background: rgba(220,53,69,0.9);
            color: white; border: none; width: 28px; height: 28px; border-radius: 50%;
            cursor: pointer; opacity: 0; transition: 0.3s;
        }
        .gallery-item:hover .delete-btn { opacity: 1; }
        .add-image-btn {
            border: 2px dashed #ccc; display: flex; flex-direction: column;
            align-items: center; justify-content: center; cursor: pointer;
            color: var(--text-light); transition: 0.3s; aspect-ratio: 1; border-radius: 8px;
        }
        .add-image-btn:hover { border-color: var(--primary); color: var(--primary); }
        .add-image-btn i { font-size: 2rem; margin-bottom: 0.5rem; }

        /* TOAST */
        .toast {
            position: fixed; bottom: 2rem; right: 2rem; padding: 1rem 1.5rem;
            border-radius: 8px; color: white; display: none; z-index: 1000;
            animation: slideIn 0.3s;
        }
        .toast.success { background: var(--secondary); }
        .toast.error { background: #dc3545; }
        .toast.show { display: flex; align-items: center; gap: 0.5rem; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        /* PAGES */
        .page { display: none; }
        .page.active { display: block; }

        /* STATUS */
        .status { display: inline-flex; align-items: center; gap: 0.4rem; padding: 0.3rem 0.8rem; border-radius: 20px; font-size: 0.8rem; }
        .status.online { background: #d4edda; color: #155724; }
        .status.offline { background: #f8d7da; color: #721c24; }

        /* COLOR PICKER */
        .color-picker { display: flex; align-items: center; gap: 1rem; }
        .color-picker input[type="color"] { width: 60px; height: 40px; border: none; cursor: pointer; border-radius: 8px; }
        .color-picker input[type="text"] { flex: 1; }

        /* SERVICES */
        .service-item { background: var(--bg); padding: 1rem; border-radius: 8px; margin-bottom: 1rem; }
        .service-item h4 { margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }
        .service-actions { display: flex; gap: 0.5rem; margin-top: 0.5rem; }
        .service-actions button { padding: 0.4rem 0.8rem; font-size: 0.85rem; }
    </style>
</head>
<body>
    <!-- LOGIN -->
    <div class="login-page" id="loginPage">
        <div class="login-box">
            <h1>üéÑ Administration</h1>
            <p>Entremets & Saveurs</p>
            <div class="error-msg" id="loginError"></div>
            <form id="loginForm">
                <div class="input-group">
                    <label>Email</label>
                    <input type="email" id="loginEmail" required>
                </div>
                <div class="input-group">
                    <label>Mot de passe</label>
                    <input type="password" id="loginPassword" required>
                </div>
                <button type="submit" class="btn btn-primary"><i class="fas fa-sign-in-alt"></i> Connexion</button>
            </form>
        </div>
    </div>

    <!-- ADMIN -->
    <div class="admin-page" id="adminPage">
        <header class="admin-header">
            <div style="display:flex;align-items:center;gap:1rem;">
                <h1>üéÑ Admin</h1>
                <span class="status online" id="statusBadge"><i class="fas fa-circle" style="font-size:8px;"></i> Connect√©</span>
            </div>
            <nav class="admin-nav">
                <a href="#" class="active" onclick="showPage('dashboard')"><i class="fas fa-home"></i> Accueil</a>
                <a href="#" onclick="showPage('textes')"><i class="fas fa-font"></i> Textes</a>
                <a href="#" onclick="showPage('images')"><i class="fas fa-images"></i> Images</a>
                <a href="#" onclick="showPage('services')"><i class="fas fa-concierge-bell"></i> Services</a>
                <a href="#" onclick="showPage('style')"><i class="fas fa-palette"></i> Style</a>
            </nav>
            <button class="btn-logout" onclick="logout()"><i class="fas fa-sign-out-alt"></i></button>
        </header>

        <main class="admin-content">
            <!-- DASHBOARD -->
            <div class="page active" id="pageDashboard">
                <div class="section">
                    <h2><i class="fas fa-sliders-h"></i> Param√®tres rapides</h2>
                    <div class="toggle-row">
                        <div class="toggle-info">
                            <h4>üéÑ Mode No√´l</h4>
                            <p>Active le th√®me festif avec couleurs rouge/vert</p>
                        </div>
                        <label class="toggle"><input type="checkbox" id="toggleNoel" onchange="saveSetting('noelMode', this.checked)"><span></span></label>
                    </div>
                    <div class="toggle-row">
                        <div class="toggle-info">
                            <h4>‚ùÑÔ∏è Neige qui tombe</h4>
                            <p>Affiche des flocons anim√©s</p>
                        </div>
                        <label class="toggle"><input type="checkbox" id="toggleSnow" onchange="saveSetting('snowMode', this.checked)"><span></span></label>
                    </div>
                    <div class="toggle-row">
                        <div class="toggle-info">
                            <h4>üì¢ Bandeau d'annonce</h4>
                            <p>Affiche le bandeau promotionnel en haut</p>
                        </div>
                        <label class="toggle"><input type="checkbox" id="toggleBanner" onchange="saveSetting('bannerMode', this.checked)"><span></span></label>
                    </div>
                </div>

                <div class="section">
                    <h2><i class="fas fa-bullhorn"></i> Bandeau promotionnel</h2>
                    <div class="form-group">
                        <label>Texte du bandeau</label>
                        <input type="text" id="bannerText" placeholder="üéÑ R√©servez vos b√ªches de No√´l !">
                    </div>
                    <div class="form-group">
                        <label>Image popup (quand on clique)</label>
                        <input type="text" id="bannerImage" placeholder="assets/images/buche tarif.jpg">
                    </div>
                    <button class="btn btn-save" onclick="saveBanner()"><i class="fas fa-save"></i> Enregistrer</button>
                </div>
            </div>

            <!-- TEXTES -->
            <div class="page" id="pageTextes">
                <div class="section">
                    <h2><i class="fas fa-heading"></i> Textes du site</h2>
                    <div class="tabs">
                        <button class="tab-btn active" onclick="showTab('tabHero', this)">Accueil (Hero)</button>
                        <button class="tab-btn" onclick="showTab('tabAbout', this)">√Ä propos</button>
                        <button class="tab-btn" onclick="showTab('tabContact', this)">Contact</button>
                    </div>

                    <div class="tab-panel active" id="tabHero">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Titre principal</label>
                                <input type="text" id="heroTitle" placeholder="Entremets">
                            </div>
                            <div class="form-group">
                                <label>Titre color√© (accent)</label>
                                <input type="text" id="heroAccent" placeholder="& Saveurs">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Sous-titre / Description</label>
                            <textarea id="heroSubtitle" placeholder="P√¢tisserie artisanale d'exception..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Texte bouton 1</label>
                            <input type="text" id="heroBtn1" placeholder="D√©couvrir">
                        </div>
                        <div class="form-group">
                            <label>Texte bouton 2</label>
                            <input type="text" id="heroBtn2" placeholder="Nous contacter">
                        </div>
                        <button class="btn btn-save" onclick="saveHero()"><i class="fas fa-save"></i> Enregistrer</button>
                    </div>

                    <div class="tab-panel" id="tabAbout">
                        <div class="form-group">
                            <label>Titre section</label>
                            <input type="text" id="aboutTitle" placeholder="Notre Histoire">
                        </div>
                        <div class="form-group">
                            <label>Paragraphe 1</label>
                            <textarea id="aboutText1" placeholder="Premier paragraphe..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Paragraphe 2</label>
                            <textarea id="aboutText2" placeholder="Deuxi√®me paragraphe..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Citation / Signature</label>
                            <input type="text" id="aboutSignature" placeholder="- Katia, Fondatrice">
                        </div>
                        <button class="btn btn-save" onclick="saveAbout()"><i class="fas fa-save"></i> Enregistrer</button>
                    </div>

                    <div class="tab-panel" id="tabContact">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Email</label>
                                <input type="email" id="contactEmail" placeholder="contact@entremets-saveurs.fr">
                            </div>
                            <div class="form-group">
                                <label>T√©l√©phone</label>
                                <input type="tel" id="contactPhone" placeholder="06 44 17 79 20">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Adresse compl√®te</label>
                            <textarea id="contactAddress" placeholder="Hameau de Rebelle, 11240 Montgradail"></textarea>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label>Lien Facebook</label>
                                <input type="url" id="contactFacebook" placeholder="https://facebook.com/...">
                            </div>
                            <div class="form-group">
                                <label>Lien Instagram</label>
                                <input type="url" id="contactInstagram" placeholder="https://instagram.com/...">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Horaires</label>
                            <input type="text" id="contactHours" placeholder="Lun-Sam: 9h-17h">
                        </div>
                        <button class="btn btn-save" onclick="saveContact()"><i class="fas fa-save"></i> Enregistrer</button>
                    </div>
                </div>
            </div>

            <!-- IMAGES -->
            <div class="page" id="pageImages">
                <div class="section">
                    <h2><i class="fas fa-images"></i> Galerie d'images</h2>
                    <p style="color:var(--text-light);margin-bottom:1rem;">G√®re les images affich√©es dans la galerie du site.</p>
                    <div class="form-group">
                        <label>Ajouter une image (chemin ou URL)</label>
                        <div style="display:flex;gap:0.5rem;">
                            <input type="text" id="newImagePath" placeholder="assets/images/mon-image.jpg">
                            <button class="btn btn-save" onclick="addImage()"><i class="fas fa-plus"></i></button>
                        </div>
                    </div>
                    <div class="gallery-grid" id="galleryGrid"></div>
                </div>

                <div class="section">
                    <h2><i class="fas fa-image"></i> Images principales</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Image Hero (fond)</label>
                            <input type="text" id="imageHero" placeholder="assets/images/hero.jpg">
                        </div>
                        <div class="form-group">
                            <label>Image √Ä propos</label>
                            <input type="text" id="imageAbout" placeholder="assets/images/about.jpg">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Logo</label>
                        <input type="text" id="imageLogo" placeholder="assets/images/logo.jpg">
                    </div>
                    <button class="btn btn-save" onclick="saveMainImages()"><i class="fas fa-save"></i> Enregistrer</button>
                </div>
            </div>

            <!-- SERVICES -->
            <div class="page" id="pageServices">
                <div class="section">
                    <h2><i class="fas fa-concierge-bell"></i> Services propos√©s</h2>
                    <p style="color:var(--text-light);margin-bottom:1rem;">Modifie les services affich√©s sur la page d'accueil.</p>
                    <div id="servicesList"></div>
                    <hr style="margin:1.5rem 0;border:none;border-top:1px solid #eee;">
                    <h3 style="margin-bottom:1rem;font-size:1rem;">Ajouter un service</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Ic√¥ne (Font Awesome)</label>
                            <input type="text" id="newServiceIcon" placeholder="fas fa-birthday-cake">
                        </div>
                        <div class="form-group">
                            <label>Titre</label>
                            <input type="text" id="newServiceTitle" placeholder="P√¢tisserie">
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Description</label>
                        <textarea id="newServiceDesc" placeholder="Description du service..."></textarea>
                    </div>
                    <button class="btn btn-save" onclick="addService()"><i class="fas fa-plus"></i> Ajouter</button>
                </div>
            </div>

            <!-- STYLE -->
            <div class="page" id="pageStyle">
                <div class="section">
                    <h2><i class="fas fa-palette"></i> Couleurs du site</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Couleur principale</label>
                            <div class="color-picker">
                                <input type="color" id="colorPrimary" value="#c41e3a">
                                <input type="text" id="colorPrimaryText" value="#c41e3a" onchange="document.getElementById('colorPrimary').value=this.value">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Couleur secondaire</label>
                            <div class="color-picker">
                                <input type="color" id="colorSecondary" value="#165b33">
                                <input type="text" id="colorSecondaryText" value="#165b33" onchange="document.getElementById('colorSecondary').value=this.value">
                            </div>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Couleur or/accent</label>
                            <div class="color-picker">
                                <input type="color" id="colorGold" value="#d4af37">
                                <input type="text" id="colorGoldText" value="#d4af37" onchange="document.getElementById('colorGold').value=this.value">
                            </div>
                        </div>
                        <div class="form-group">
                            <label>Couleur fond</label>
                            <div class="color-picker">
                                <input type="color" id="colorBg" value="#f8f9fa">
                                <input type="text" id="colorBgText" value="#f8f9fa" onchange="document.getElementById('colorBg').value=this.value">
                            </div>
                        </div>
                    </div>
                    <button class="btn btn-save" onclick="saveColors()"><i class="fas fa-save"></i> Enregistrer</button>
                </div>

                <div class="section">
                    <h2><i class="fas fa-font"></i> Polices</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Police des titres</label>
                            <select id="fontTitle">
                                <option value="Playfair Display">Playfair Display</option>
                                <option value="Cormorant Garamond">Cormorant Garamond</option>
                                <option value="Libre Baskerville">Libre Baskerville</option>
                                <option value="Merriweather">Merriweather</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Police du texte</label>
                            <select id="fontBody">
                                <option value="Poppins">Poppins</option>
                                <option value="Inter">Inter</option>
                                <option value="Open Sans">Open Sans</option>
                                <option value="Lato">Lato</option>
                            </select>
                        </div>
                    </div>
                    <button class="btn btn-save" onclick="saveFonts()"><i class="fas fa-save"></i> Enregistrer</button>
                </div>

                <div class="section">
                    <h2><i class="fas fa-cog"></i> SEO & M√©tadonn√©es</h2>
                    <div class="form-group">
                        <label>Titre de la page (balise title)</label>
                        <input type="text" id="seoTitle" placeholder="Entremets et Saveurs - P√¢tisserie d'Exception">
                    </div>
                    <div class="form-group">
                        <label>Description (meta description)</label>
                        <textarea id="seoDescription" placeholder="P√¢tisserie artisanale √† Limoux..."></textarea>
                    </div>
                    <button class="btn btn-save" onclick="saveSeo()"><i class="fas fa-save"></i> Enregistrer</button>
                </div>
            </div>
        </main>
    </div>

    <!-- TOAST -->
    <div class="toast" id="toast"><i class="fas fa-check"></i> <span id="toastMsg">Sauvegard√© !</span></div>

    <!-- FIREBASE -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>

    <script>
        // CONFIG FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyCPTfARbFsZTdRxNA5CohEEDrLLs4Bcb5Y",
            authDomain: "entremets-et-saveurs.firebaseapp.com",
            databaseURL: "https://entremets-et-saveurs-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "entremets-et-saveurs",
            storageBucket: "entremets-et-saveurs.firebasestorage.app",
            messagingSenderId: "445743402926",
            appId: "1:445743402926:web:c57d0f7a9fecb3b115023f"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();

        // AUTH
        document.getElementById('loginForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (err) {
                document.getElementById('loginError').textContent = 'Email ou mot de passe incorrect';
                document.getElementById('loginError').style.display = 'block';
            }
        });

        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('adminPage').style.display = 'block';
                loadAllData();
            } else {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('adminPage').style.display = 'none';
            }
        });

        function logout() { auth.signOut(); }

        // NAVIGATION
        function showPage(page) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById('page' + page.charAt(0).toUpperCase() + page.slice(1)).classList.add('active');
            document.querySelectorAll('.admin-nav a').forEach(a => a.classList.remove('active'));
            event.target.closest('a').classList.add('active');
        }

        function showTab(tabId, btn) {
            btn.closest('.section').querySelectorAll('.tab-panel').forEach(p => p.classList.remove('active'));
            btn.closest('.section').querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            btn.classList.add('active');
        }

        // TOAST
        function toast(msg, type = 'success') {
            const t = document.getElementById('toast');
            t.className = 'toast show ' + type;
            document.getElementById('toastMsg').textContent = msg;
            setTimeout(() => t.classList.remove('show'), 3000);
        }

        // LOAD DATA
        function loadAllData() {
            // Settings
            db.ref('settings').on('value', snap => {
                const d = snap.val() || {};
                document.getElementById('toggleNoel').checked = d.noelMode !== false;
                document.getElementById('toggleSnow').checked = d.snowMode !== false;
                document.getElementById('toggleBanner').checked = d.bannerMode !== false;
            });

            // Banner
            db.ref('banner').on('value', snap => {
                const d = snap.val() || {};
                document.getElementById('bannerText').value = d.text || '';
                document.getElementById('bannerImage').value = d.image || '';
            });

            // Hero
            db.ref('hero').on('value', snap => {
                const d = snap.val() || {};
                document.getElementById('heroTitle').value = d.title || '';
                document.getElementById('heroAccent').value = d.accent || '';
                document.getElementById('heroSubtitle').value = d.subtitle || '';
                document.getElementById('heroBtn1').value = d.btn1 || '';
                document.getElementById('heroBtn2').value = d.btn2 || '';
            });

            // About
            db.ref('about').on('value', snap => {
                const d = snap.val() || {};
                document.getElementById('aboutTitle').value = d.title || '';
                document.getElementById('aboutText1').value = d.text1 || '';
                document.getElementById('aboutText2').value = d.text2 || '';
                document.getElementById('aboutSignature').value = d.signature || '';
            });

            // Contact
            db.ref('contact').on('value', snap => {
                const d = snap.val() || {};
                document.getElementById('contactEmail').value = d.email || '';
                document.getElementById('contactPhone').value = d.phone || '';
                document.getElementById('contactAddress').value = d.address || '';
                document.getElementById('contactFacebook').value = d.facebook || '';
                document.getElementById('contactInstagram').value = d.instagram || '';
                document.getElementById('contactHours').value = d.hours || '';
            });

            // Colors
            db.ref('colors').on('value', snap => {
                const d = snap.val() || {};
                if(d.primary) { document.getElementById('colorPrimary').value = d.primary; document.getElementById('colorPrimaryText').value = d.primary; }
                if(d.secondary) { document.getElementById('colorSecondary').value = d.secondary; document.getElementById('colorSecondaryText').value = d.secondary; }
                if(d.gold) { document.getElementById('colorGold').value = d.gold; document.getElementById('colorGoldText').value = d.gold; }
                if(d.bg) { document.getElementById('colorBg').value = d.bg; document.getElementById('colorBgText').value = d.bg; }
            });

            // Fonts
            db.ref('fonts').on('value', snap => {
                const d = snap.val() || {};
                if(d.title) document.getElementById('fontTitle').value = d.title;
                if(d.body) document.getElementById('fontBody').value = d.body;
            });

            // SEO
            db.ref('seo').on('value', snap => {
                const d = snap.val() || {};
                document.getElementById('seoTitle').value = d.title || '';
                document.getElementById('seoDescription').value = d.description || '';
            });

            // Images
            db.ref('images').on('value', snap => {
                const d = snap.val() || {};
                document.getElementById('imageHero').value = d.hero || '';
                document.getElementById('imageAbout').value = d.about || '';
                document.getElementById('imageLogo').value = d.logo || '';
            });

            // Gallery
            db.ref('gallery').on('value', snap => {
                const d = snap.val() || [];
                renderGallery(d);
            });

            // Services
            db.ref('services').on('value', snap => {
                const d = snap.val() || [];
                renderServices(d);
            });
        }

        // SAVE FUNCTIONS
        function saveSetting(key, value) {
            db.ref('settings/' + key).set(value);
            toast('Param√®tre mis √† jour !');
        }

        function saveBanner() {
            db.ref('banner').set({
                text: document.getElementById('bannerText').value,
                image: document.getElementById('bannerImage').value
            });
            toast('Bandeau enregistr√© !');
        }

        function saveHero() {
            db.ref('hero').set({
                title: document.getElementById('heroTitle').value,
                accent: document.getElementById('heroAccent').value,
                subtitle: document.getElementById('heroSubtitle').value,
                btn1: document.getElementById('heroBtn1').value,
                btn2: document.getElementById('heroBtn2').value
            });
            toast('Hero enregistr√© !');
        }

        function saveAbout() {
            db.ref('about').set({
                title: document.getElementById('aboutTitle').value,
                text1: document.getElementById('aboutText1').value,
                text2: document.getElementById('aboutText2').value,
                signature: document.getElementById('aboutSignature').value
            });
            toast('√Ä propos enregistr√© !');
        }

        function saveContact() {
            db.ref('contact').set({
                email: document.getElementById('contactEmail').value,
                phone: document.getElementById('contactPhone').value,
                address: document.getElementById('contactAddress').value,
                facebook: document.getElementById('contactFacebook').value,
                instagram: document.getElementById('contactInstagram').value,
                hours: document.getElementById('contactHours').value
            });
            toast('Contact enregistr√© !');
        }

        function saveColors() {
            db.ref('colors').set({
                primary: document.getElementById('colorPrimary').value,
                secondary: document.getElementById('colorSecondary').value,
                gold: document.getElementById('colorGold').value,
                bg: document.getElementById('colorBg').value
            });
            toast('Couleurs enregistr√©es !');
        }

        function saveFonts() {
            db.ref('fonts').set({
                title: document.getElementById('fontTitle').value,
                body: document.getElementById('fontBody').value
            });
            toast('Polices enregistr√©es !');
        }

        function saveSeo() {
            db.ref('seo').set({
                title: document.getElementById('seoTitle').value,
                description: document.getElementById('seoDescription').value
            });
            toast('SEO enregistr√© !');
        }

        function saveMainImages() {
            db.ref('images').set({
                hero: document.getElementById('imageHero').value,
                about: document.getElementById('imageAbout').value,
                logo: document.getElementById('imageLogo').value
            });
            toast('Images enregistr√©es !');
        }

        // GALLERY
        function renderGallery(images) {
            const grid = document.getElementById('galleryGrid');
            grid.innerHTML = '';
            (Array.isArray(images) ? images : []).forEach((img, i) => {
                grid.innerHTML += `
                    <div class="gallery-item">
                        <img src="${img}" alt="Image ${i+1}">
                        <button class="delete-btn" onclick="deleteImage(${i})"><i class="fas fa-times"></i></button>
                    </div>`;
            });
        }

        function addImage() {
            const path = document.getElementById('newImagePath').value.trim();
            if (!path) return;
            db.ref('gallery').once('value', snap => {
                const arr = snap.val() || [];
                arr.push(path);
                db.ref('gallery').set(arr);
                document.getElementById('newImagePath').value = '';
                toast('Image ajout√©e !');
            });
        }

        function deleteImage(index) {
            if (!confirm('Supprimer cette image ?')) return;
            db.ref('gallery').once('value', snap => {
                const arr = snap.val() || [];
                arr.splice(index, 1);
                db.ref('gallery').set(arr);
                toast('Image supprim√©e !', 'error');
            });
        }

        // SERVICES
        function renderServices(services) {
            const list = document.getElementById('servicesList');
            list.innerHTML = '';
            (Array.isArray(services) ? services : []).forEach((s, i) => {
                list.innerHTML += `
                    <div class="service-item">
                        <h4><i class="${s.icon}"></i> ${s.title}</h4>
                        <p style="color:var(--text-light);font-size:0.9rem;">${s.description}</p>
                        <div class="service-actions">
                            <button class="btn btn-danger" onclick="deleteService(${i})"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>`;
            });
        }

        function addService() {
            const icon = document.getElementById('newServiceIcon').value.trim();
            const title = document.getElementById('newServiceTitle').value.trim();
            const desc = document.getElementById('newServiceDesc').value.trim();
            if (!title) return;
            db.ref('services').once('value', snap => {
                const arr = snap.val() || [];
                arr.push({ icon, title, description: desc });
                db.ref('services').set(arr);
                document.getElementById('newServiceIcon').value = '';
                document.getElementById('newServiceTitle').value = '';
                document.getElementById('newServiceDesc').value = '';
                toast('Service ajout√© !');
            });
        }

        function deleteService(index) {
            if (!confirm('Supprimer ce service ?')) return;
            db.ref('services').once('value', snap => {
                const arr = snap.val() || [];
                arr.splice(index, 1);
                db.ref('services').set(arr);
                toast('Service supprim√© !', 'error');
            });
        }

        // Sync color inputs
        document.getElementById('colorPrimary').addEventListener('input', e => document.getElementById('colorPrimaryText').value = e.target.value);
        document.getElementById('colorSecondary').addEventListener('input', e => document.getElementById('colorSecondaryText').value = e.target.value);
        document.getElementById('colorGold').addEventListener('input', e => document.getElementById('colorGoldText').value = e.target.value);
        document.getElementById('colorBg').addEventListener('input', e => document.getElementById('colorBgText').value = e.target.value);
    </script>
</body>
</html>
